import e from"prop-types";import{useLocation as t,parsePath as r,matchRoutes as n,useRoutes as o,createRoutesFromChildren as a}from"react-router";import i,{createContext as c,useRef as s,useContext as u,useMemo as l,useCallback as f,useEffect as p}from"react";import{findDOMNode as v}from"react-dom";import{TransitionGroup as d,CSSTransition as m}from"react-transition-group";function b(e,t){if(e==null)return{};var r={};var n=Object.keys(e);var o,a;for(a=0;a<n.length;a++){o=n[a];if(t.indexOf(o)>=0)continue;r[o]=e[o]}return r}function y(e,t){if(e==null)return{};var r=b(e,t);var n,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++){n=a[o];if(t.indexOf(n)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,n))continue;r[n]=e[n]}}return r}function h(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){h(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var j=c({parentMatches:null});var E=["routes"];var x=typeof window==="undefined";var P={key:"",isPush:true};var w="REACT_HISTORIES_KEY";var N=x?[]:(sessionStorage.getItem(w)||"").split(",").filter(Boolean);var T=function e(t,r){if(x){return true}var n=t.key||t.pathname+t.search;if(r&&n!==P.key){var o=N.lastIndexOf(n);var a=o<0||o+1===N.length;if(a){N.push(n)}else{N.splice(o+1)}sessionStorage.setItem(w,N.join(","));P={isPush:a,key:n}}return P.isPush};var k=function e(t){var r=t.routes,n=y(t,E);return D(r,n,true)};function D(e){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var c=arguments[2];var b=t();var y=s(null);var h=u(j),O=h.parentMatches,E=h.parentBase,P=E===void 0?a.pathnameBase:E,w=h.location;var N=a.className,D=a.timeout,B=a.prefix,S=B===void 0?"animated-router":B,I=a.appear,M=a.enter,_=a.exit,z=a.component,L=a.location,R=L===void 0?w||b:L;var W=s({inTransition:false}).current;if(typeof R==="string"){R=r(R)}var A=l((function(){var t;if(c){return O}P=[P,O===null||O===void 0?void 0:(t=O[O.length-1])===null||t===void 0?void 0:t.pathnameBase].filter(Boolean).join("/").replace(/\/\/+/g,"/");return n(e,R,P)}),[R,e,O,c])||[];var C=A.find((function(t){return e.includes(t.route)}));var F=C&&"".concat(e.indexOf(C.route),"_").concat(C.pathnameBase);var H=i.createElement(j.Provider,{value:{parentMatches:A,parentBase:P,location:R}},o(e.map((function(e){var t;if((t=e.children)!==null&&t!==void 0&&t.length){var r=i.createElement(k,Object.assign({},a,{routes:e.children,location:R}));return g(g({},e),{},{children:[{element:r,children:e.children}]})}return e})),R));var K=f((function(e){if(W.rootNode){var t="".concat(S,"-in-transition");W.rootNode.className=W.rootNode.className.split(/\s+/).filter((function(e){return e!==t})).concat(e?t:[]).join(" ")}}),[S,W]);var Y=f((function(e){W.inTransition||K(W.inTransition=true);W.lastTransitionNode=e}),[W,K]);var $=f((function(e){if(e&&typeof D==="number"){e.style.transitionDuration=e.style.WebkitTransitionDuration=e.style.MozTransitionDuration="".concat(D,"ms")}}),[D]);var q=f((function(e){if(W.lastTransitionNode===e){W.inTransition&&K(W.inTransition=false)}if(e){e.className=e.className.split(/\s+/).filter((function(e){return!/-(?:forward|backward)-(?:enter|exit|appear)(?:-active|-done)?$/.test(e)})).join(" ");if(typeof D==="number"){e.style.transitionDuration=e.style.WebkitTransitionDuration=e.style.MozTransitionDuration=""}}}),[W,K,D]);var G={appear:I,enter:M,exit:_,component:z};var J={onExit:Y,onExiting:$,onExited:q,onEnter:Y,onEntering:$,onEntered:q};var Q=["".concat(S,"-container"),"react-animated-router",N];p((function(){W.rootNode=v(y.current)}),[W]);if(x){return H}return i.createElement(d,Object.assign({ref:y,className:Q.filter(Boolean).join(" "),childFactory:function e(t){var r="".concat(S,"-").concat(T(R,t.props.in)?"forward":"backward");return i.cloneElement(t,{classNames:r})}},G),i.createElement(m,Object.assign({key:F||R.pathname,addEndListener:function e(t,r){t.addEventListener("transitionend",(function(e){if(e.target===t){r()}}),false)},unmountOnExit:true,timeout:D},J),H))}var B=["children"];var S=function e(t){var r=t.children,n=y(t,B);var o=a(r);return D(o,n)};S.propTypes={className:e.string,pathnameBase:e.string,timeout:e.number,prefix:e.string,appear:e.bool,enter:e.bool,exit:e.bool,component:e.any,children:e.node};S.defaultProps={prefix:"animated-router"};export{S as default,D as useAnimatedRoutes};
