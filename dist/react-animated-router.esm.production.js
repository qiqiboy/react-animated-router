import e from"prop-types";import{useLocation as t,UNSAFE_RouteContext as r,parsePath as n,matchRoutes as o,useRoutes as i,createRoutesFromChildren as a}from"react-router";import u,{createContext as c,useContext as l,useState as s,useRef as f,useMemo as p,cloneElement as d,useCallback as v}from"react";import{TransitionGroup as m,CSSTransition as y}from"react-transition-group";function b(e,t){if(e==null)return{};var r={};var n=Object.keys(e);var o,i;for(i=0;i<n.length;i++){o=n[i];if(t.indexOf(o)>=0)continue;r[o]=e[o]}return r}function h(e,t){if(e==null)return{};var r=b(e,t);var n,o;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++){n=i[o];if(t.indexOf(n)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,n))continue;r[n]=e[n]}}return r}function g(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){g(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function E(e){if(Array.isArray(e))return e}function w(e,t){var r=e==null?null:typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r==null)return;var n=[];var o=true;var i=false;var a,u;try{for(r=r.call(e);!(o=(a=r.next()).done);o=true){n.push(a.value);if(t&&n.length===t)break}}catch(e){i=true;u=e}finally{try{if(!o&&r["return"]!=null)r["return"]()}finally{if(i)throw u}}return n}function x(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++){n[r]=e[r]}return n}function N(e,t){if(!e)return;if(typeof e==="string")return x(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return x(e,t)}function P(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function S(e,t){return E(e)||w(e,t)||N(e,t)||P()}var T=c({routeMatches:[]});T.displayName="AnimatedRouterContext";var k=["routes"];var D=typeof window==="undefined";var I={key:"",isPush:true};var A="REACT_HISTORIES_KEY";var M=D?[]:(sessionStorage.getItem(A)||"").split(",").filter(Boolean);var B=function e(t,r){if(D){return true}var n=t.key||t.pathname+t.search;if(r&&n!==I.key){var o=M.lastIndexOf(n);var i=o<0||o+1===M.length;if(i){if(o>-1){M.splice(o)}M.push(n)}else{M.splice(o+1)}sessionStorage.setItem(A,M.join(","));I={isPush:i,key:n}}return I.isPush};var C=function e(t){var r=t.routes,n=h(t,k);return R(r,n,true)};function R(e){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var c=arguments[2];var b=t();var h=l(r),g=h.matches;var O=l(T),E=O.routeMatches,w=O.location;var x=a.className,N=a.timeout,P=a.prefix,k=P===void 0?"animated-router":P,I=a.appear,A=a.enter,M=a.exit,R=a.component,_=a.location,z=_===void 0?w||b:_;var L=s((function(){return"".concat(k,"-root-").concat(Math.random().toString(36).slice(2))})),W=S(L,1),$=W[0];var q=f({inTransition:false}).current;if(typeof z==="string"){z=n(z)}E=p((function(){var t;return(c?E:o(e,z,(t=g[g.length-1])===null||t===void 0?void 0:t.pathnameBase))||[]}),[z,e,g,E,c]);var F=E.find((function(t){return e.includes(t.route)}));var H=F&&"".concat(e.indexOf(F.route),"_").concat(F.pathnameBase);var K=u.createElement(T.Provider,{value:{routeMatches:E,location:z}},i(e.map((function(e){var t;if((t=e.children)!==null&&t!==void 0&&t.length){var r=u.createElement(C,Object.assign({},a,{routes:e.children}));return typeof e.element==="undefined"?j(j({},e),{},{element:d(r,{component:null})}):j(j({},e),{},{children:[{element:r,children:e.children}]})}return e})),z));var U=v((function(e){if(q.rootNode){var t="".concat(k,"-in-transition");q.rootNode.className=q.rootNode.className.split(/\s+/).filter((function(e){return e!==t})).concat(e?t:[]).join(" ")}}),[k,q]);var Y=v((function(e){if(!q.rootNode){q.rootNode=R?document.querySelector(".".concat($)):e===null||e===void 0?void 0:e.parentNode}q.inTransition||U(q.inTransition=true);if(e){q.lastTransitionNode=e}}),[q,U,$,R]);var G=v((function(e){if(e&&typeof N==="number"){e.style.transitionDuration=e.style.WebkitTransitionDuration=e.style.MozTransitionDuration="".concat(N,"ms")}}),[N]);var J=v((function(e){if(q.lastTransitionNode===e){q.inTransition&&U(q.inTransition=false)}if(e){e.className=e.className.split(/\s+/).filter((function(e){return!/-(?:forward|backward)-(?:enter|exit|appear)(?:-active|-done)?$/.test(e)})).join(" ");if(typeof N==="number"){e.style.transitionDuration=e.style.WebkitTransitionDuration=e.style.MozTransitionDuration=""}}}),[q,U,N]);var Q={appear:I,enter:A,exit:M,component:R};var V={onExit:Y,onExiting:G,onExited:J,onEnter:Y,onEntering:G,onEntered:J};var X=["react-animated-router","".concat(k,"-container"),$,x];if(D){return K}return u.createElement(m,Object.assign({className:X.filter(Boolean).join(" "),childFactory:function e(t){var r="".concat(k,"-").concat(B(z,t.props.in)?"forward":"backward");return d(t,{classNames:r})}},Q),u.createElement(y,Object.assign({key:H||z.pathname,addEndListener:function e(t,r){t.addEventListener("transitionend",(function(e){if(e.target===t){r()}}),false)},unmountOnExit:true,timeout:N},V),K))}var _=["children"];var z=function e(t){var r=t.children,n=h(t,_);var o=a(r);return R(o,n)};z.propTypes={className:e.string,timeout:e.number,prefix:e.string,appear:e.bool,enter:e.bool,exit:e.bool,component:e.any,children:e.node};z.defaultProps={prefix:"animated-router"};export{z as default,R as useAnimatedRoutes};
