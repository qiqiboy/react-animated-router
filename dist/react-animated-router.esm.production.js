import e from"prop-types";import{useLocation as t,parsePath as r,useRoutes as n,UNSAFE_RouteContext as a,matchRoutes as o,renderMatches as i,createRoutesFromChildren as c}from"react-router";import u,{createContext as l,useContext as s,useMemo as f,cloneElement as p,useState as m,useRef as v,useCallback as d}from"react";import{TransitionGroup as y,CSSTransition as b}from"react-transition-group";function h(e,t){if(e==null)return{};var r={};var n=Object.keys(e);var a,o;for(o=0;o<n.length;o++){a=n[o];if(t.indexOf(a)>=0)continue;r[a]=e[a]}return r}function g(e,t){if(e==null)return{};var r=h(e,t);var n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++){n=o[a];if(t.indexOf(n)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,n))continue;r[n]=e[n]}}return r}function O(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach((function(t){O(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function w(e){if(Array.isArray(e))return e}function x(e,t){var r=e==null?null:typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r==null)return;var n=[];var a=true;var o=false;var i,c;try{for(r=r.call(e);!(a=(i=r.next()).done);a=true){n.push(i.value);if(t&&n.length===t)break}}catch(e){o=true;c=e}finally{try{if(!a&&r["return"]!=null)r["return"]()}finally{if(o)throw c}}return n}function P(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++){n[r]=e[r]}return n}function N(e,t){if(!e)return;if(typeof e==="string")return P(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return P(e,t)}function S(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(e,t){return w(e)||x(e,t)||N(e,t)||S()}var k=l({});k.displayName="AnimatedRouterContext";var D=typeof window==="undefined";var I={key:"",isPush:true};var A="REACT_HISTORIES_KEY";var B=D?[]:(sessionStorage.getItem(A)||"").split(",").filter(Boolean);var M=function e(t,r){if(D){return true}var n=t.key||t.pathname+t.search;if(r&&n!==I.key){var a=B.lastIndexOf(n);var o=a<0||a+1===B.length;if(o){if(a>-1){B.splice(a)}B.push(n)}else{B.splice(a+1)}sessionStorage.setItem(A,B.join(","));I={isPush:o,key:n}}return I.isPush};var C=function e(t){return t.join("/").replace(/\/\/+/g,"/")};var R=function e(t){var r=t.routes,n=t.children,c=t.className,l=t.timeout,h=t.prefix,g=t.appear,O=t.enter,j=t.exit,w=t.component,x=t.location;var P=m((function(){return"".concat(h,"-root-").concat(Math.random().toString(36).slice(2))})),N=T(P,1),S=N[0];var D=s(a),I=D.matches;var A=v({inTransition:false}).current;var B=f((function(){return I[I.length-1]||{}}),[I]);var R=f((function(){return o(r,x,B.pathnameBase)||[]}),[x,r,B]);var _=R.length>0&&"".concat(r.indexOf(R[0].route),"_").concat(R[0].pathnameBase);n=f((function(){if(typeof n!=="undefined"){return n}var e=B.params||{};var t=B.pathnameBase||"/";return i(R.map((function(r){return E(E({},r),{},{params:E(E({},e),r.params),pathname:C([t,r.pathname]),pathnameBase:r.pathnameBase==="/"?t:C([t,r.pathnameBase])})})))}),[n,B,R]);var z=d((function(e){if(A.rootNode){var t="".concat(h,"-in-transition");A.rootNode.className=A.rootNode.className.split(/\s+/).filter((function(e){return e!==t})).concat(e?t:[]).join(" ")}}),[h,A]);var L=d((function(e){if(!A.rootNode){A.rootNode=w?document.querySelector(".".concat(S)):e===null||e===void 0?void 0:e.parentNode}A.inTransition||z(A.inTransition=true);if(e){A.lastTransitionNode=e}}),[A,z,S,w]);var W=d((function(e){if(e&&typeof l==="number"){e.style.transitionDuration=e.style.WebkitTransitionDuration=e.style.MozTransitionDuration="".concat(l,"ms")}}),[l]);var $=d((function(e){if(A.lastTransitionNode===e){A.inTransition&&z(A.inTransition=false)}if(e){e.className=e.className.split(/\s+/).filter((function(e){return!/-(?:forward|backward)-(?:enter|exit|appear)(?:-active|-done)?$/.test(e)})).join(" ");if(typeof l==="number"){e.style.transitionDuration=e.style.WebkitTransitionDuration=e.style.MozTransitionDuration=""}}}),[A,z,l]);var q={appear:g,enter:O,exit:j,component:w};var F={onExit:L,onExiting:W,onExited:$,onEnter:L,onEntering:W,onEntered:$};var H=["react-animated-router","".concat(h,"-container"),S,c];if(!n){return n}return u.createElement(y,Object.assign({className:H.filter(Boolean).join(" "),childFactory:function e(t){var r="".concat(h,"-").concat(M(x,t.props.in)?"forward":"backward");return p(t,{classNames:r})}},q),u.createElement(b,Object.assign({key:_||x.pathname,addEndListener:function e(t,r){t.addEventListener("transitionend",(function(e){if(e.target===t){r()}}),false)},unmountOnExit:true,timeout:l},F),u.createElement(k.Provider,{value:{location:x}},n)))};R.defaultProps={prefix:"animated-router"};function _(e,a){var o=t();var i=s(k),c=i.location;var l=a||{},m=l.location,v=m===void 0?c||o:m;v=f((function(){return typeof v==="string"?r(v):v}),[v]);var d=function e(t,r){return u.createElement(R,Object.assign({},a,{routes:t,location:v,children:r}))};var y=function e(t){return t.map((function(t){var r;if((r=t.children)!==null&&r!==void 0&&r.length){var n=d(e(t.children));return typeof t.element==="undefined"?E(E({},t),{},{element:p(n,{component:null})}):E(E({},t),{},{children:[{element:n,children:t.children}]})}return t}))};var b=y(e);var h=n(b,v);return d(b,h)}var z=["children"];var L=function e(t){var r=t.children,n=g(t,z);var a=c(r);return _(a,n)};L.propTypes={className:e.string,timeout:e.number,prefix:e.string,appear:e.bool,enter:e.bool,exit:e.bool,component:e.any,children:e.node};L.defaultProps=R.defaultProps;export{L as default,_ as useAnimatedRoutes};
