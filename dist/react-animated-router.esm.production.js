import e from"prop-types";import{useLocation as t,parsePath as r,useRoutes as n,UNSAFE_RouteContext as o,useNavigationType as i,matchRoutes as a,UNSAFE_LocationContext as c,createPath as u,NavigationType as l,createRoutesFromChildren as s}from"react-router";import f,{useMemo as p,cloneElement as v,useState as d,useContext as m,useRef as y,useCallback as b}from"react";import{TransitionGroup as h,CSSTransition as g}from"react-transition-group";function O(e,t){if(e==null)return{};var r={};var n=Object.keys(e);var o,i;for(i=0;i<n.length;i++){o=n[i];if(t.indexOf(o)>=0)continue;r[o]=e[o]}return r}function j(e,t){if(e==null)return{};var r=O(e,t);var n,o;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++){n=i[o];if(t.indexOf(n)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,n))continue;r[n]=e[n]}}return r}function E(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){E(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function x(e){if(Array.isArray(e))return e}function N(e,t){var r=e==null?null:typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r==null)return;var n=[];var o=true;var i=false;var a,c;try{for(r=r.call(e);!(o=(a=r.next()).done);o=true){n.push(a.value);if(t&&n.length===t)break}}catch(e){i=true;c=e}finally{try{if(!o&&r["return"]!=null)r["return"]()}finally{if(i)throw c}}return n}function T(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++){n[r]=e[r]}return n}function S(e,t){if(!e)return;if(typeof e==="string")return T(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return T(e,t)}function k(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function D(e,t){return x(e)||N(e,t)||S(e,t)||k()}var I=typeof window==="undefined";var A={key:"default",isPush:true};var B="REACT_HISTORIES_KEY";var M=I?[]:(sessionStorage.getItem(B)||"").split(",").filter(Boolean);var R=function e(t,r,n){if(I){return true}var o=t.key||u(t);if(n&&o!==A.key){var i=M.lastIndexOf(A.key);var a=true;if(r===l.Replace){M.splice(i,1,o)}else if(r===l.Push){i>-1&&M.splice(i+1);M.push(o)}else{var c=M.lastIndexOf(o);a=i<c}sessionStorage.setItem(B,M.join(","));A={isPush:a,key:o}}return A.isPush};var _=function e(t){var r=t.routes,n=t.children,u=t.className,l=t.timeout,s=t.prefix,p=t.appear,O=t.enter,j=t.exit,E=t.component,w=t.location;var P=d((function(){return"".concat(s,"-root-").concat(Math.random().toString(36).slice(2))})),x=D(P,1),N=x[0];var T=m(o),S=T.matches,k=T.outlet;var I=i();var A=y({inTransition:false}).current;var B=S[S.length-1]||{};var M=a(r,w,B.pathnameBase)||[];var _=M.length>0&&"".concat(r.indexOf(M[0].route),"_").concat(M[0].pathnameBase);if(typeof n==="undefined"){n=k}var z=b((function(e){if(A.rootNode){var t="".concat(s,"-in-transition");A.rootNode.className=A.rootNode.className.split(/\s+/).filter((function(e){return e!==t})).concat(e?t:[]).join(" ")}}),[s,A]);var C=b((function(e){if(!A.rootNode){A.rootNode=E?document.querySelector(".".concat(N)):e===null||e===void 0?void 0:e.parentNode}A.inTransition||z(A.inTransition=true);if(e){A.lastTransitionNode=e}}),[A,z,N,E]);var L=b((function(e){if(e&&typeof l==="number"){e.style.transitionDuration=e.style.WebkitTransitionDuration=e.style.MozTransitionDuration="".concat(l,"ms")}}),[l]);var W=b((function(e){if(A.lastTransitionNode===e){A.inTransition&&z(A.inTransition=false)}if(e){e.className=e.className.split(/\s+/).filter((function(e){return!/-(?:forward|backward)-(?:enter|exit|appear)(?:-active|-done)?$/.test(e)})).join(" ");if(typeof l==="number"){e.style.transitionDuration=e.style.WebkitTransitionDuration=e.style.MozTransitionDuration=""}}}),[A,z,l]);var $={appear:p,enter:O,exit:j,component:E};var q={onExit:C,onExiting:L,onExited:W,onEnter:C,onEntering:L,onEntered:W};var F=["react-animated-router","".concat(s,"-container"),N,u];if(!n){return n}return f.createElement(h,Object.assign({className:F.filter(Boolean).join(" "),childFactory:function e(t){var r="".concat(s,"-").concat(R(w,I,t.props.in)?"forward":"backward");return v(t,{classNames:r})}},$),f.createElement(g,Object.assign({key:_||w.pathname,addEndListener:function e(t,r){t.addEventListener("transitionend",(function(e){if(e.target===t){r()}}),false)},unmountOnExit:true,timeout:l},q),f.createElement(c.Provider,{value:{location:w,navigationType:I}},n)))};_.defaultProps={prefix:"animated-router"};function z(e,o){var i=t();var a=o||{},c=a.location;var u=p((function(){return c?P(P({},i),typeof c==="string"?r(c):c):i}),[i,c]);var l=function e(t,r){return f.createElement(_,Object.assign({},o,{routes:t,location:u,children:r}))};var s=function e(t){return t.map((function(t){var r;if((r=t.children)!==null&&r!==void 0&&r.length){var n=e(t.children);var o=l(n);return typeof t.element==="undefined"?P(P({},t),{},{element:v(o,{component:null}),children:n}):P(P({},t),{},{children:[{element:o,children:n}]})}return t}))};var d=s(e);var m=n(d,u);return l(d,m)}var C=["children"];var L=function e(t){var r=t.children,n=j(t,C);var o=s(r);return z(o,n)};L.propTypes={className:e.string,timeout:e.number,prefix:e.string,appear:e.bool,enter:e.bool,exit:e.bool,component:e.any,children:e.node};L.defaultProps=_.defaultProps;export{L as AnimatedRoutes,L as default,z as useAnimatedRoutes};
