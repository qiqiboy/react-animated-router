import t,{useRef as e,useMemo as n,isValidElement as r,useCallback as i,useEffect as a}from"react";import{findDOMNode as o}from"react-dom";import{TransitionGroup as s,CSSTransition as c}from"react-transition-group";import{useLocation as u,createRoutesFromChildren as l,matchRoutes as f,createPath as p,resolvePath as d,useRoutes as m}from"react-router";function v(t,e,n){if(e in t){Object.defineProperty(t,e,{value:n,enumerable:true,configurable:true,writable:true})}else{t[e]=n}return t}function y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function b(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?y(Object(n),!0).forEach((function(e){v(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var h=typeof window==="undefined";var O={key:"",isPush:true};var g="REACT_HISTORIES_KEY";var j=h?[]:(sessionStorage.getItem(g)||"").split(",").filter(Boolean);var E=function t(e,n){if(h){return true}var r=e.key||e.pathname+e.search;if(n&&r!==O.key){var i=j.lastIndexOf(r);if(i>-1){j.splice(i+1)}else{j.push(r)}sessionStorage.setItem(g,j.join(","));O={isPush:i<0,key:r}}return O.isPush};var T=function v(y){var O=u();var g=e(null);var j=y.className,T=y.children,P=y.timeout,w=y.prefix,N=y.appear,x=y.enter,k=y.exit,D=y.transitionKey,A=y.component,S=y._parentPath,I=y.location,_=I===void 0?O:I;var z=e({inTransition:false,inAppearTransition:!!N}).current;var B=n((function(){return!Array.isArray(T)||r(T[0])?l(T):T}),[T])||[];if(!D&&B.length){var K=f(B.map((function(t){return b(b({},t),{},{path:p(d(t.path||"",S))})})),_);D=K===null||K===void 0?void 0:K[0].pathname}var L=function e(n){return n.map((function(e){var n;if((n=e.children)!==null&&n!==void 0&&n.length){var r=t.createElement(v,Object.assign({},y,{children:e.children,location:_,_parentPath:p(d(e.path||"",S))}));return b(b({},e),{},{children:[{element:r,children:e.children}]})}return e}))};var M=m(L(B),_);var R=i((function(t){if(z.rootNode){var e="".concat(w,"-in-transition");z.rootNode.className=z.rootNode.className.split(/\s+/).filter((function(t){return t!==e})).concat(t?e:[]).join(" ")}}),[w,z]);var W=i((function(t){z.inTransition||R(z.inTransition=true);z.lastTransitionNode=t}),[z,R]);var C=i((function(t){if(t&&typeof P==="number"){t.style.transitionDuration=t.style.WebkitTransitionDuration=t.style.MozTransitionDuration="".concat(P,"ms")}}),[P]);var F=i((function(t){if(z.lastTransitionNode===t){z.inTransition&&R(z.inTransition=false)}if(z.inAppearTransition){z.inAppearTransition=false}if(t){t.className=t.className.split(/\s+/).filter((function(t){return!/-(?:forward|backward)-(?:enter|exit)(?:-active)?$/.test(t)})).join(" ");if(typeof P==="number"){t.style.transitionDuration=t.style.WebkitTransitionDuration=t.style.MozTransitionDuration=""}}}),[z,R,P]);var H={appear:N,enter:x,exit:k,component:A};var Y={onExit:W,onExiting:C,onExited:F,onEnter:W,onEntering:C,onEntered:F};var $=["".concat(w,"-container"),"react-animated-router",j];a((function(){z.rootNode=o(g.current)}),[z]);if(h||!M){return M}return t.createElement(s,Object.assign({ref:g,className:$.filter(Boolean).join(" "),childFactory:function e(n){var r="".concat(w,"-").concat(E(_,z.inAppearTransition?false:n.props.in)?"forward":"backward");return t.cloneElement(n,{classNames:r})}},H),t.createElement(c,Object.assign({key:D||_.pathname,addEndListener:function t(e,n){e.addEventListener("transitionend",(function(t){if(t.target===e){n()}}),false)},unmountOnExit:true,timeout:P},Y),M))};T.defaultProps={prefix:"animated-router"};export{T as default};
