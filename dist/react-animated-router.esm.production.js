import e from"prop-types";import{useLocation as t,parsePath as r,matchRoutes as n,useRoutes as o,createRoutesFromChildren as a}from"react-router";import i,{createContext as c,useContext as u,useState as l,useRef as s,useMemo as f,cloneElement as p,useCallback as d}from"react";import{TransitionGroup as v,CSSTransition as m}from"react-transition-group";function y(e,t){if(e==null)return{};var r={};var n=Object.keys(e);var o,a;for(a=0;a<n.length;a++){o=n[a];if(t.indexOf(o)>=0)continue;r[o]=e[o]}return r}function b(e,t){if(e==null)return{};var r=y(e,t);var n,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++){n=a[o];if(t.indexOf(n)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,n))continue;r[n]=e[n]}}return r}function h(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){h(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function j(e){if(Array.isArray(e))return e}function E(e,t){var r=e==null?null:typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r==null)return;var n=[];var o=true;var a=false;var i,c;try{for(r=r.call(e);!(o=(i=r.next()).done);o=true){n.push(i.value);if(t&&n.length===t)break}}catch(e){a=true;c=e}finally{try{if(!o&&r["return"]!=null)r["return"]()}finally{if(a)throw c}}return n}function w(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++){n[r]=e[r]}return n}function x(e,t){if(!e)return;if(typeof e==="string")return w(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return w(e,t)}function N(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function P(e,t){return j(e)||E(e,t)||x(e,t)||N()}var S=c({parentMatches:null});S.displayName="AnimatedRouterContext";var T=["routes"];var k=typeof window==="undefined";var D={key:"",isPush:true};var B="REACT_HISTORIES_KEY";var I=k?[]:(sessionStorage.getItem(B)||"").split(",").filter(Boolean);var A=function e(t,r){if(k){return true}var n=t.key||t.pathname+t.search;if(r&&n!==D.key){var o=I.lastIndexOf(n);var a=o<0||o+1===I.length;if(a){I.push(n)}else{I.splice(o+1)}sessionStorage.setItem(B,I.join(","));D={isPush:a,key:n}}return D.isPush};var M=function e(t){var r=t.routes,n=b(t,T);return C(r,n,true)};function C(e){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var c=arguments[2];var y=t();var b=u(S),h=b.parentMatches,g=b.parentBase,j=g===void 0?a.pathnameBase:g,E=b.location;var w=a.className,x=a.timeout,N=a.prefix,T=N===void 0?"animated-router":N,D=a.appear,B=a.enter,I=a.exit,C=a.component,R=a.location,_=R===void 0?E||y:R;var z=l((function(){return"".concat(T,"-root-").concat(Math.random().toString(36).slice(2))})),L=P(z,1),W=L[0];var $=s({inTransition:false}).current;if(typeof _==="string"){_=r(_)}j=f((function(){var e;return c?j:[j,h===null||h===void 0?void 0:(e=h[h.length-1])===null||e===void 0?void 0:e.pathnameBase].filter(Boolean).join("/").replace(/\/\/+/g,"/")}),[h,j,c]);var q=f((function(){return(c?h:n(e,_,j))||[]}),[_,e,h,j,c]);var F=q.find((function(t){return e.includes(t.route)}));var H=F&&"".concat(e.indexOf(F.route),"_").concat(F.pathnameBase);var K=i.createElement(S.Provider,{value:{parentMatches:q,parentBase:j,location:_}},o(e.map((function(e){var t;if((t=e.children)!==null&&t!==void 0&&t.length){var r=i.createElement(M,Object.assign({},a,{routes:e.children,location:_}));return typeof e.element==="undefined"?O(O({},e),{},{element:p(r,{component:null})}):O(O({},e),{},{children:[{element:r,children:e.children}]})}return e})),_));var U=d((function(e){if($.rootNode){var t="".concat(T,"-in-transition");$.rootNode.className=$.rootNode.className.split(/\s+/).filter((function(e){return e!==t})).concat(e?t:[]).join(" ")}}),[T,$]);var Y=d((function(e){if(!$.rootNode){$.rootNode=C?document.querySelector(".".concat(W)):e===null||e===void 0?void 0:e.parentNode}$.inTransition||U($.inTransition=true);$.lastTransitionNode=e}),[$,U,W,C]);var G=d((function(e){if(e&&typeof x==="number"){e.style.transitionDuration=e.style.WebkitTransitionDuration=e.style.MozTransitionDuration="".concat(x,"ms")}}),[x]);var J=d((function(e){if($.lastTransitionNode===e){$.inTransition&&U($.inTransition=false)}if(e){e.className=e.className.split(/\s+/).filter((function(e){return!/-(?:forward|backward)-(?:enter|exit|appear)(?:-active|-done)?$/.test(e)})).join(" ");if(typeof x==="number"){e.style.transitionDuration=e.style.WebkitTransitionDuration=e.style.MozTransitionDuration=""}}}),[$,U,x]);var Q={appear:D,enter:B,exit:I,component:C};var V={onExit:Y,onExiting:G,onExited:J,onEnter:Y,onEntering:G,onEntered:J};var X=["react-animated-router","".concat(T,"-container"),W,w];if(k){return K}return i.createElement(v,Object.assign({className:X.filter(Boolean).join(" "),childFactory:function e(t){var r="".concat(T,"-").concat(A(_,t.props.in)?"forward":"backward");return i.cloneElement(t,{classNames:r})}},Q),i.createElement(m,Object.assign({key:H||_.pathname,addEndListener:function e(t,r){t.addEventListener("transitionend",(function(e){if(e.target===t){r()}}),false)},unmountOnExit:true,timeout:x},V),K))}var R=["children"];var _=function e(t){var r=t.children,n=b(t,R);var o=a(r);return C(o,n)};_.propTypes={className:e.string,pathnameBase:e.string,timeout:e.number,prefix:e.string,appear:e.bool,enter:e.bool,exit:e.bool,component:e.any,children:e.node};_.defaultProps={prefix:"animated-router"};export{_ as default,C as useAnimatedRoutes};
